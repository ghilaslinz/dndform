{"ast":null,"code":"import dbconnect from \"../../../mongoose/mongoose\";\nimport form from \"../../../mongoose/models/form\";\nimport graph from \"../../../mongoose/models/graph\";\nimport mongoose from \"mongoose\";\ndbconnect();\n\nconst handleGraphdata = data => {\n  const l = data.length;\n  let tools = [];\n\n  for (let i = 0; i < l; i++) {\n    const element = data[i];\n    const kl = element.options.length;\n    let option = [];\n\n    for (let k = 0; k < kl; k++) {\n      const elementt = element.options[k];\n      option.push({\n        key: elementt.key,\n        text: elementt.text,\n        count: 0\n      });\n    }\n\n    tools.push({\n      name: element.field_name,\n      value: option\n    });\n  }\n\n  console.log(\"tools\", tools);\n  return tools;\n};\n\nexport default (async (req, res) => {\n  const {\n    method,\n    query\n  } = req;\n\n  switch (method) {\n    case \"GET\":\n      try {\n        await form.findById(query.id).then(data => {\n          res.json([...data.tools]);\n        });\n      } catch (error) {\n        res.status(404).json({\n          error\n        });\n        res.end();\n      }\n\n      break;\n\n    case \"POST\":\n      try {\n        if (req.body.task_data.length !== 0) {\n          form.updateOne({\n            _id: query.id\n          }, {\n            $set: {\n              tools: [...req.body.task_data]\n            }\n          }).exec();\n          await graph.find({\n            formId: query.id\n          }).exec().then(data => {\n            const handlednotgrahfound = handleGraphdata(...req.body.task_data);\n            console.log(\"mmm\", ...handlednotgrahfound);\n\n            if (!data.length) {\n              const newgraf = new graph({\n                _id: new mongoose.Types.ObjectId(),\n                formId: query.id,\n                tools: [...handlednotgrahfound]\n              });\n              newgraf.save().then(data => {\n                console.log(\"created\");\n              });\n            } else {\n              const replace = graph.updateOne({\n                formId: query.id\n              }, {\n                tools: [...handlednotgrahfound]\n              }).exec();\n              console.log(\"replace\", replace);\n            }\n          });\n        }\n      } catch (error) {\n        console.log(error);\n        res.status(400).json({\n          sucees: false\n        });\n      }\n\n      break;\n\n    default:\n      break;\n  }\n});","map":{"version":3,"sources":["D:/upwork projects/New folder (4)/form-projet-finale/pages/api/findform/[id].js"],"names":["dbconnect","form","graph","mongoose","handleGraphdata","data","l","length","tools","i","element","kl","options","option","k","elementt","push","key","text","count","name","field_name","value","console","log","req","res","method","query","findById","id","then","json","error","status","end","body","task_data","updateOne","_id","$set","exec","find","formId","handlednotgrahfound","newgraf","Types","ObjectId","save","replace","sucees"],"mappings":"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","sourcesContent":["import dbconnect from \"../../../mongoose/mongoose\";\r\nimport form from \"../../../mongoose/models/form\";\r\nimport graph from \"../../../mongoose/models/graph\";\r\nimport mongoose from \"mongoose\";\r\ndbconnect();\r\n\r\nconst handleGraphdata = (data) => {\r\n\tconst l = data.length;\r\n\tlet tools = [];\r\n\r\n\tfor (let i = 0; i < l; i++) {\r\n\t\tconst element = data[i];\r\n\t\tconst kl = element.options.length;\r\n\t\tlet option = [];\r\n\t\tfor (let k = 0; k < kl; k++) {\r\n\t\t\tconst elementt = element.options[k];\r\n\t\t\toption.push({ key: elementt.key, text: elementt.text, count: 0 });\r\n\t\t}\r\n\t\ttools.push({ name: element.field_name, value: option });\r\n\t}\r\n\tconsole.log(\"tools\", tools);\r\n\treturn tools;\r\n};\r\n\r\nexport default async (req, res) => {\r\n\tconst { method, query } = req;\r\n\tswitch (method) {\r\n\t\tcase \"GET\":\r\n\t\t\ttry {\r\n\t\t\t\tawait form.findById(query.id).then((data) => {\r\n\t\t\t\t\tres.json([...data.tools]);\r\n\t\t\t\t});\r\n\t\t\t} catch (error) {\r\n\t\t\t\tres.status(404).json({ error });\r\n\t\t\t\tres.end();\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"POST\":\r\n\t\t\ttry {\r\n\t\t\t\tif (req.body.task_data.length !== 0) {\r\n\t\t\t\t\tform\r\n\t\t\t\t\t\t.updateOne(\r\n\t\t\t\t\t\t\t{ _id: query.id },\r\n\t\t\t\t\t\t\t{ $set: { tools: [...req.body.task_data] } }\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.exec();\r\n\r\n\t\t\t\t\tawait graph\r\n\t\t\t\t\t\t.find({ formId: query.id })\r\n\t\t\t\t\t\t.exec()\r\n\t\t\t\t\t\t.then((data) => {\r\n\t\t\t\t\t\t\tconst handlednotgrahfound = handleGraphdata(\r\n\t\t\t\t\t\t\t\t...req.body.task_data\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tconsole.log(\"mmm\", ...handlednotgrahfound);\r\n\t\t\t\t\t\t\tif (!data.length) {\r\n\t\t\t\t\t\t\t\tconst newgraf = new graph({\r\n\t\t\t\t\t\t\t\t\t_id: new mongoose.Types.ObjectId(),\r\n\t\t\t\t\t\t\t\t\tformId: query.id,\r\n\t\t\t\t\t\t\t\t\ttools: [...handlednotgrahfound],\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tnewgraf.save().then((data) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"created\");\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tconst replace = graph\r\n\t\t\t\t\t\t\t\t\t.updateOne(\r\n\t\t\t\t\t\t\t\t\t\t{ formId: query.id },\r\n\t\t\t\t\t\t\t\t\t\t{ tools: [...handlednotgrahfound] }\r\n\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t.exec();\r\n\t\t\t\t\t\t\t\tconsole.log(\"replace\", replace);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t\tres.status(400).json({ sucees: false });\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t}\r\n};\r\n"]},"metadata":{},"sourceType":"module"}