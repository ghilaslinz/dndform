{"ast":null,"code":"import dbconnect from \"../../../mongoose/mongoose\";\nimport form from \"../../../mongoose/models/form\";\nimport graph from \"../../../mongoose/models/graph\";\nimport mongoose from \"mongoose\";\ndbconnect();\n\nconst handleGraphdata = (data, formid) => {\n  const l = data.length;\n\n  for (let i = 0; i < l; i++) {\n    const element = data[i];\n\n    if (element.options) {\n      const kl = element.options.length;\n\n      for (let k = 0; k < kl; k++) {\n        const elementt = element.options[k];\n        console.log(element.label);\n        graph.find({\n          qusetionId: element.id\n        }).exec().then(data => {\n          if (data.length < 1) {\n            console.log(\"it un\");\n            const newgraf = new graph({\n              _id: new mongoose.Types.ObjectId(),\n              formId: formid,\n              qusetionId: element.id,\n              ques: element.label,\n              optionId: elementt.key,\n              text: elementt.text,\n              count: 0\n            });\n            newgraf.save().then(data => {});\n          } else {\n            if (data.length < kl) {\n              data.forEach(obb => {\n                if (obb.text !== elementt.text) {\n                  const newgraf = new graph({\n                    _id: new mongoose.Types.ObjectId(),\n                    formId: formid,\n                    qusetionId: element.id,\n                    ques: element.label,\n                    optionId: elementt.key,\n                    text: elementt.text,\n                    count: 0\n                  });\n                  newgraf.save().then(data => {});\n                }\n              });\n            }\n          }\n        });\n      }\n    }\n  }\n};\n\nexport default (async (req, res) => {\n  const {\n    method,\n    query\n  } = req;\n\n  switch (method) {\n    case \"GET\":\n      try {\n        await form.findById(query.id).then(data => {\n          if (data.tools) {\n            res.json([...data.tools]);\n          }\n        });\n      } catch (error) {\n        res.status(404).json({\n          error\n        });\n        res.end();\n      }\n\n      break;\n\n    case \"POST\":\n      try {\n        if (req.body.task_data.length !== 0) {\n          form.updateOne({\n            _id: query.id\n          }, {\n            $set: {\n              tools: [...req.body.task_data]\n            }\n          }).exec();\n          const handlegraph = await handleGraphdata(req.body.task_data, query.id);\n\n          if (handlegraph) {\n            res.status(200).json({\n              sucees: true\n            });\n          } else {\n            res.status(404).json({\n              sucees: false\n            });\n          }\n        }\n      } catch (error) {\n        console.log(error);\n        res.status(400).json({\n          sucees: false\n        });\n      }\n\n      break;\n\n    default:\n      break;\n  }\n});","map":{"version":3,"sources":["D:/upwork projects/New folder (4)/form-projet-finale/pages/api/findform/[id].js"],"names":["dbconnect","form","graph","mongoose","handleGraphdata","data","formid","l","length","i","element","options","kl","k","elementt","console","log","label","find","qusetionId","id","exec","then","newgraf","_id","Types","ObjectId","formId","ques","optionId","key","text","count","save","forEach","obb","req","res","method","query","findById","tools","json","error","status","end","body","task_data","updateOne","$set","handlegraph","sucees"],"mappings":"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","sourcesContent":["import dbconnect from \"../../../mongoose/mongoose\";\r\nimport form from \"../../../mongoose/models/form\";\r\nimport graph from \"../../../mongoose/models/graph\";\r\nimport mongoose from \"mongoose\";\r\ndbconnect();\r\n\r\nconst handleGraphdata = (data, formid) => {\r\n\tconst l = data.length;\r\n\tfor (let i = 0; i < l; i++) {\r\n\t\tconst element = data[i];\r\n\t\tif (element.options) {\r\n\t\t\tconst kl = element.options.length;\r\n\t\t\tfor (let k = 0; k < kl; k++) {\r\n\t\t\t\tconst elementt = element.options[k];\r\n\t\t\t\tconsole.log(element.label);\r\n\t\t\t\tgraph\r\n\t\t\t\t\t.find({\r\n\t\t\t\t\t\tqusetionId: element.id,\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.exec()\r\n\t\t\t\t\t.then((data) => {\r\n\t\t\t\t\t\tif (data.length < 1) {\r\n\t\t\t\t\t\t\tconsole.log(\"it un\");\r\n\r\n\t\t\t\t\t\t\tconst newgraf = new graph({\r\n\t\t\t\t\t\t\t\t_id: new mongoose.Types.ObjectId(),\r\n\t\t\t\t\t\t\t\tformId: formid,\r\n\t\t\t\t\t\t\t\tqusetionId: element.id,\r\n\t\t\t\t\t\t\t\tques: element.label,\r\n\t\t\t\t\t\t\t\toptionId: elementt.key,\r\n\t\t\t\t\t\t\t\ttext: elementt.text,\r\n\t\t\t\t\t\t\t\tcount: 0,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tnewgraf.save().then((data) => {});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (data.length < kl) {\r\n\t\t\t\t\t\t\t\tdata.forEach((obb) => {\r\n\t\t\t\t\t\t\t\t\tif (obb.text !== elementt.text) {\r\n\t\t\t\t\t\t\t\t\t\tconst newgraf = new graph({\r\n\t\t\t\t\t\t\t\t\t\t\t_id: new mongoose.Types.ObjectId(),\r\n\t\t\t\t\t\t\t\t\t\t\tformId: formid,\r\n\t\t\t\t\t\t\t\t\t\t\tqusetionId: element.id,\r\n\t\t\t\t\t\t\t\t\t\t\tques: element.label,\r\n\t\t\t\t\t\t\t\t\t\t\toptionId: elementt.key,\r\n\t\t\t\t\t\t\t\t\t\t\ttext: elementt.text,\r\n\t\t\t\t\t\t\t\t\t\t\tcount: 0,\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\tnewgraf.save().then((data) => {});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport default async (req, res) => {\r\n\tconst { method, query } = req;\r\n\tswitch (method) {\r\n\t\tcase \"GET\":\r\n\t\t\ttry {\r\n\t\t\t\tawait form.findById(query.id).then((data) => {\r\n\t\t\t\t\tif (data.tools) {\r\n\t\t\t\t\t\tres.json([...data.tools]);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} catch (error) {\r\n\t\t\t\tres.status(404).json({ error });\r\n\t\t\t\tres.end();\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"POST\":\r\n\t\t\ttry {\r\n\t\t\t\tif (req.body.task_data.length !== 0) {\r\n\t\t\t\t\tform\r\n\t\t\t\t\t\t.updateOne(\r\n\t\t\t\t\t\t\t{ _id: query.id },\r\n\t\t\t\t\t\t\t{ $set: { tools: [...req.body.task_data] } }\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t\t.exec();\r\n\t\t\t\t\tconst handlegraph = await handleGraphdata(\r\n\t\t\t\t\t\treq.body.task_data,\r\n\t\t\t\t\t\tquery.id\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (handlegraph) {\r\n\t\t\t\t\t\tres.status(200).json({ sucees: true });\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tres.status(404).json({ sucees: false });\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t\tres.status(400).json({ sucees: false });\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t}\r\n};\r\n"]},"metadata":{},"sourceType":"module"}