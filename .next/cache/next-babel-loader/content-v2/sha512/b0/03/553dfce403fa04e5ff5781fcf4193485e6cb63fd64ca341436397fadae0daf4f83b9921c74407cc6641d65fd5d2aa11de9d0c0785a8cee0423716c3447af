{"ast":null,"code":"import dbconnect from \"../../../mongoose/mongoose\";\nimport graph from \"../../../mongoose/models/graph\";\ndbconnect();\n\nconst handleoldansewers = async (newGraphdata, id) => {\n  newGraphdata.forEach(ob => {\n    if (typeof ob.value !== \"string\") {\n      ob.value.forEach(key => {\n        const findGraph = graph.find({\n          formId: id,\n          optionId: key\n        }).exec((err, result) => {\n          if (result.optionId) {\n            const answe = graph.findOneAndUpdate({\n              _id: result[0]._id\n            }, {\n              $inc: {\n                count: 1\n              }\n            }).exec((errrr, anss) => {\n              console.log(errrr);\n              console.log(\"22ans\", anss);\n            });\n          }\n        });\n      });\n    } else {\n      const findGrap = graph.find({\n        formId: id,\n        optionId: key\n      }).exec((err, result) => {\n        console.log(err);\n        console.log(result);\n\n        if (result.optionId) {\n          const answer = graph.findOneAndUpdate({\n            _id: result[0]._id\n          }, {\n            count: result[0].count + 1\n          }).exec((errr, ans) => {\n            console.log(errr);\n            console.log(\"22ans\", ans);\n          });\n        }\n      });\n    }\n  });\n};\n\nexport default (async (req, res) => {\n  const {\n    method,\n    query\n  } = req;\n\n  switch (method) {\n    case \"GET\":\n      try {\n        const findGraph = await graph.findById(query.id);\n        res.json(findGraph);\n      } catch (error) {\n        res.status(400).json({\n          error\n        });\n        res.end();\n      }\n\n      break;\n\n    case \"POST\":\n      try {\n        const handledAns = await handleoldansewers(req.body, query.id);\n        res.json(handledAns);\n      } catch (error) {\n        console.log(error);\n        res.status(400).json({\n          sucees: false\n        });\n      }\n\n      break;\n\n    default:\n      break;\n  }\n});","map":{"version":3,"sources":["D:/upwork projects/New folder (4)/form-projet-finale/pages/api/submitform/[id].js"],"names":["dbconnect","graph","handleoldansewers","newGraphdata","id","forEach","ob","value","key","findGraph","find","formId","optionId","exec","err","result","answe","findOneAndUpdate","_id","$inc","count","errrr","anss","console","log","findGrap","answer","errr","ans","req","res","method","query","findById","json","error","status","end","handledAns","body","sucees"],"mappings":"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","sourcesContent":["import dbconnect from \"../../../mongoose/mongoose\";\r\n\r\nimport graph from \"../../../mongoose/models/graph\";\r\n\r\ndbconnect();\r\n\r\nconst handleoldansewers = async (newGraphdata, id) => {\r\n\tnewGraphdata.forEach((ob) => {\r\n\t\tif (typeof ob.value !== \"string\") {\r\n\t\t\tob.value.forEach((key) => {\r\n\t\t\t\tconst findGraph = graph\r\n\t\t\t\t\t.find({ formId: id, optionId: key })\r\n\t\t\t\t\t.exec((err, result) => {\r\n\t\t\t\t\t\tif (result.optionId) {\r\n\t\t\t\t\t\t\tconst answe = graph\r\n\t\t\t\t\t\t\t\t.findOneAndUpdate(\r\n\t\t\t\t\t\t\t\t\t{ _id: result[0]._id },\r\n\t\t\t\t\t\t\t\t\t{ $inc: { count: 1 } }\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t.exec((errrr, anss) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log(errrr);\r\n\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"22ans\", anss);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconst findGrap = graph\r\n\t\t\t\t.find({ formId: id, optionId: key })\r\n\t\t\t\t.exec((err, result) => {\r\n\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\tconsole.log(result);\r\n\r\n\t\t\t\t\tif (result.optionId) {\r\n\t\t\t\t\t\tconst answer = graph\r\n\t\t\t\t\t\t\t.findOneAndUpdate(\r\n\t\t\t\t\t\t\t\t{ _id: result[0]._id },\r\n\t\t\t\t\t\t\t\t{ count: result[0].count + 1 }\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t.exec((errr, ans) => {\r\n\t\t\t\t\t\t\t\tconsole.log(errr);\r\n\r\n\t\t\t\t\t\t\t\tconsole.log(\"22ans\", ans);\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t});\r\n};\r\n\r\nexport default async (req, res) => {\r\n\tconst { method, query } = req;\r\n\tswitch (method) {\r\n\t\tcase \"GET\":\r\n\t\t\ttry {\r\n\t\t\t\tconst findGraph = await graph.findById(query.id);\r\n\t\t\t\tres.json(findGraph);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tres.status(400).json({ error });\r\n\t\t\t\tres.end();\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"POST\":\r\n\t\t\ttry {\r\n\t\t\t\tconst handledAns = await handleoldansewers(req.body, query.id);\r\n\t\t\t\tres.json(handledAns);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t\tres.status(400).json({ sucees: false });\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t}\r\n};\r\n"]},"metadata":{},"sourceType":"module"}