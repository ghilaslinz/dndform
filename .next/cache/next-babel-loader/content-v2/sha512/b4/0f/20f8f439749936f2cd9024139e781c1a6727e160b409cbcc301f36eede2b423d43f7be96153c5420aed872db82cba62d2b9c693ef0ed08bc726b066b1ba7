{"ast":null,"code":"import dbconnect from \"../../../mongoose/mongoose\";\nimport graph from \"../../../mongoose/models/graph\";\ndbconnect();\n\nconst handleoldansewers = (newGraphdata, {\n  tools\n}) => {\n  let optionss = [];\n  console.log(\"t\", tools);\n  let tttt = newGraphdata.forEach((ob, index) => {\n    let option = [];\n    let key = [];\n    ob.value.forEach((kkey, jj) => {\n      key.push(kkey);\n    });\n    console.log(\"i\", tools[index]);\n    let llll = tools[index].value.forEach((obje, j) => {\n      if (obje.key === key[j]) {\n        option.push({\n          key: obje.key,\n          text: obje.text,\n          count: obje.count + 1\n        });\n      } else {\n        option.push({\n          key: obje.key,\n          text: obje.text,\n          count: obje.count\n        });\n      }\n    });\n    optionss.push({\n      name: ob.name,\n      value: option\n    });\n  });\n  return optionss;\n};\n\nexport default (async (req, res) => {\n  const {\n    method,\n    query\n  } = req;\n\n  switch (method) {\n    case \"GET\":\n      try {\n        const findGraph = await graph.findById(query.id);\n        res.json(findGraph);\n        console.log(req.body);\n      } catch (error) {\n        res.status(400).json({\n          error\n        });\n        res.end();\n      }\n\n      break;\n\n    case \"POST\":\n      try {\n        const findGraph = await graph.find({\n          formId: query.id\n        }).exec();\n        console.log(\"f\", findGraph[0].tolls);\n        const handledAns = await handleoldansewers(req.body, ...findGraph);\n        graph.updateOne({\n          formId: query.id\n        }, {\n          $set: {\n            tools: [...handledAns]\n          }\n        }).exec().then(data => {\n          res.status(200).json(data);\n        });\n      } catch (error) {\n        console.log(error);\n        res.status(400).json({\n          sucees: false\n        });\n      }\n\n      break;\n\n    default:\n      break;\n  }\n});","map":{"version":3,"sources":["D:/upwork projects/New folder (4)/form-projet-finale/pages/api/submitform/[id].js"],"names":["dbconnect","graph","handleoldansewers","newGraphdata","tools","optionss","console","log","tttt","forEach","ob","index","option","key","value","kkey","jj","push","llll","obje","j","text","count","name","req","res","method","query","findGraph","findById","id","json","body","error","status","end","find","formId","exec","tolls","handledAns","updateOne","$set","then","data","sucees"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,4BAAtB;AAEA,OAAOC,KAAP,MAAkB,gCAAlB;AAEAD,SAAS;;AAET,MAAME,iBAAiB,GAAG,CAACC,YAAD,EAAe;AAAEC,EAAAA;AAAF,CAAf,KAA6B;AACtD,MAAIC,QAAQ,GAAG,EAAf;AACAC,EAAAA,OAAO,CAACC,GAAR,CAAY,GAAZ,EAAiBH,KAAjB;AACA,MAAII,IAAI,GAAGL,YAAY,CAACM,OAAb,CAAqB,CAACC,EAAD,EAAKC,KAAL,KAAe;AAC9C,QAAIC,MAAM,GAAG,EAAb;AACA,QAAIC,GAAG,GAAG,EAAV;AACAH,IAAAA,EAAE,CAACI,KAAH,CAASL,OAAT,CAAiB,CAACM,IAAD,EAAOC,EAAP,KAAc;AAC9BH,MAAAA,GAAG,CAACI,IAAJ,CAASF,IAAT;AACA,KAFD;AAGAT,IAAAA,OAAO,CAACC,GAAR,CAAY,GAAZ,EAAiBH,KAAK,CAACO,KAAD,CAAtB;AACA,QAAIO,IAAI,GAAGd,KAAK,CAACO,KAAD,CAAL,CAAaG,KAAb,CAAmBL,OAAnB,CAA2B,CAACU,IAAD,EAAOC,CAAP,KAAa;AAClD,UAAID,IAAI,CAACN,GAAL,KAAaA,GAAG,CAACO,CAAD,CAApB,EAAyB;AACxBR,QAAAA,MAAM,CAACK,IAAP,CAAY;AACXJ,UAAAA,GAAG,EAAEM,IAAI,CAACN,GADC;AAEXQ,UAAAA,IAAI,EAAEF,IAAI,CAACE,IAFA;AAGXC,UAAAA,KAAK,EAAEH,IAAI,CAACG,KAAL,GAAa;AAHT,SAAZ;AAKA,OAND,MAMO;AACNV,QAAAA,MAAM,CAACK,IAAP,CAAY;AACXJ,UAAAA,GAAG,EAAEM,IAAI,CAACN,GADC;AAEXQ,UAAAA,IAAI,EAAEF,IAAI,CAACE,IAFA;AAGXC,UAAAA,KAAK,EAAEH,IAAI,CAACG;AAHD,SAAZ;AAKA;AACD,KAdU,CAAX;AAeAjB,IAAAA,QAAQ,CAACY,IAAT,CAAc;AAAEM,MAAAA,IAAI,EAAEb,EAAE,CAACa,IAAX;AAAiBT,MAAAA,KAAK,EAAEF;AAAxB,KAAd;AACA,GAvBU,CAAX;AAyBA,SAAOP,QAAP;AACA,CA7BD;;AA+BA,gBAAe,OAAOmB,GAAP,EAAYC,GAAZ,KAAoB;AAClC,QAAM;AAAEC,IAAAA,MAAF;AAAUC,IAAAA;AAAV,MAAoBH,GAA1B;;AACA,UAAQE,MAAR;AACC,SAAK,KAAL;AACC,UAAI;AACH,cAAME,SAAS,GAAG,MAAM3B,KAAK,CAAC4B,QAAN,CAAeF,KAAK,CAACG,EAArB,CAAxB;AACAL,QAAAA,GAAG,CAACM,IAAJ,CAASH,SAAT;AACAtB,QAAAA,OAAO,CAACC,GAAR,CAAYiB,GAAG,CAACQ,IAAhB;AACA,OAJD,CAIE,OAAOC,KAAP,EAAc;AACfR,QAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB;AAAEE,UAAAA;AAAF,SAArB;AACAR,QAAAA,GAAG,CAACU,GAAJ;AACA;;AACD;;AACD,SAAK,MAAL;AACC,UAAI;AACH,cAAMP,SAAS,GAAG,MAAM3B,KAAK,CAACmC,IAAN,CAAW;AAAEC,UAAAA,MAAM,EAAEV,KAAK,CAACG;AAAhB,SAAX,EAAiCQ,IAAjC,EAAxB;AACAhC,QAAAA,OAAO,CAACC,GAAR,CAAY,GAAZ,EAAiBqB,SAAS,CAAC,CAAD,CAAT,CAAaW,KAA9B;AACA,cAAMC,UAAU,GAAG,MAAMtC,iBAAiB,CAACsB,GAAG,CAACQ,IAAL,EAAW,GAAGJ,SAAd,CAA1C;AAEA3B,QAAAA,KAAK,CACHwC,SADF,CACY;AAAEJ,UAAAA,MAAM,EAAEV,KAAK,CAACG;AAAhB,SADZ,EACkC;AAAEY,UAAAA,IAAI,EAAE;AAAEtC,YAAAA,KAAK,EAAE,CAAC,GAAGoC,UAAJ;AAAT;AAAR,SADlC,EAEEF,IAFF,GAGEK,IAHF,CAGQC,IAAD,IAAU;AACfnB,UAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqBa,IAArB;AACA,SALF;AAMA,OAXD,CAWE,OAAOX,KAAP,EAAc;AACf3B,QAAAA,OAAO,CAACC,GAAR,CAAY0B,KAAZ;AACAR,QAAAA,GAAG,CAACS,MAAJ,CAAW,GAAX,EAAgBH,IAAhB,CAAqB;AAAEc,UAAAA,MAAM,EAAE;AAAV,SAArB;AACA;;AACD;;AAED;AACC;AA9BF;AAgCA,CAlCD","sourcesContent":["import dbconnect from \"../../../mongoose/mongoose\";\r\n\r\nimport graph from \"../../../mongoose/models/graph\";\r\n\r\ndbconnect();\r\n\r\nconst handleoldansewers = (newGraphdata, { tools }) => {\r\n\tlet optionss = [];\r\n\tconsole.log(\"t\", tools);\r\n\tlet tttt = newGraphdata.forEach((ob, index) => {\r\n\t\tlet option = [];\r\n\t\tlet key = [];\r\n\t\tob.value.forEach((kkey, jj) => {\r\n\t\t\tkey.push(kkey);\r\n\t\t});\r\n\t\tconsole.log(\"i\", tools[index]);\r\n\t\tlet llll = tools[index].value.forEach((obje, j) => {\r\n\t\t\tif (obje.key === key[j]) {\r\n\t\t\t\toption.push({\r\n\t\t\t\t\tkey: obje.key,\r\n\t\t\t\t\ttext: obje.text,\r\n\t\t\t\t\tcount: obje.count + 1,\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\toption.push({\r\n\t\t\t\t\tkey: obje.key,\r\n\t\t\t\t\ttext: obje.text,\r\n\t\t\t\t\tcount: obje.count,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\toptionss.push({ name: ob.name, value: option });\r\n\t});\r\n\r\n\treturn optionss;\r\n};\r\n\r\nexport default async (req, res) => {\r\n\tconst { method, query } = req;\r\n\tswitch (method) {\r\n\t\tcase \"GET\":\r\n\t\t\ttry {\r\n\t\t\t\tconst findGraph = await graph.findById(query.id);\r\n\t\t\t\tres.json(findGraph);\r\n\t\t\t\tconsole.log(req.body);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tres.status(400).json({ error });\r\n\t\t\t\tres.end();\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase \"POST\":\r\n\t\t\ttry {\r\n\t\t\t\tconst findGraph = await graph.find({ formId: query.id }).exec();\r\n\t\t\t\tconsole.log(\"f\", findGraph[0].tolls);\r\n\t\t\t\tconst handledAns = await handleoldansewers(req.body, ...findGraph);\r\n\r\n\t\t\t\tgraph\r\n\t\t\t\t\t.updateOne({ formId: query.id }, { $set: { tools: [...handledAns] } })\r\n\t\t\t\t\t.exec()\r\n\t\t\t\t\t.then((data) => {\r\n\t\t\t\t\t\tres.status(200).json(data);\r\n\t\t\t\t\t});\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.log(error);\r\n\t\t\t\tres.status(400).json({ sucees: false });\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t}\r\n};\r\n"]},"metadata":{},"sourceType":"module"}